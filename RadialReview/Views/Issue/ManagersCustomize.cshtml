<hr />
<h2>A few final details:</h2>
<br />
<div class="row">
    <div class="col-md-5 col-md-push-7 ">
        <p class="well">
            Great! Managers will need some time to customize the reviews. During this pre-review period, managers will be able to customize who their subordinates review.
            Please specify when you want the prereview period to end. Afterwards, please specify when you want employees to be finished with their reviews.
            <br />
            The review will automatically be generated after the prereview deadline.
        </p>
    </div>
    <div class="col-md-7 col-md-pull-5 ">
        <div class="row smallBreak2">
            <div class="col-md-6">
                <label class="control-label">Review name:</label>
            </div>
            <div class="col-md-4">
                @Html.TextBox("ReviewName", null, new { @class = "form-control datePicker", id = "ReviewName" })
                <!--input name="date" id="date" class="form-control col-xs-2" size="30" type="text" value=""-->
            </div>
        </div>
        <div class="row smallBreak2">
            <div class="col-md-6">
                <label class="control-label">Manager prereview due:</label>
            </div>
            <div class="col-md-4">
                <div class="date" data-date="@DateTime.Now.ToString("dd-MM-yyyy")" data-date-format="dd-mm-yyyy">
                    <div class="">
                        @Html.TextBox("PrereviewDate", null, new { @class = "form-control datePicker", id = "PrereviewDate" })
                        <!--input name="date" id="date" class="form-control col-xs-2" size="30" type="text" value=""-->
                    </div>
                    <span class="add-on"><i class="icon-th"></i></span>
                </div>
            </div>
        </div>
        <div class="row smallBreak2">
            <div class="col-md-6">
                <label class="control-label ">Reviews are due:</label>
            </div>
            <div class="col-md-4 alignCenter">
                <div class="date" data-date="@DateTime.Now.ToString("dd-MM-yyyy")" data-date-format="dd-mm-yyyy">
                    <div class="">
                        @Html.TextBox("DueDate", null, new { @class = "form-control datePicker", id = "DueDate" })
                        <!--input name="date" id="date" class="form-control col-xs-2" size="30" type="text" value=""-->
                    </div>
                    <span class="add-on"><i class="icon-th"></i></span>
                </div>
            </div>
        </div>
        @*<div class="row smallBreak2">
            <div class="col-md-6">
                <label class="control-label">Email employees:</label>
            </div>
            <div class="col-md-4">
                @Html.CheckBox("SendEmails")
            </div>
        </div>*@
    </div>
</div>
<input name="review" value="issuePrereview" type="hidden">
<button type="submit" id="submitButton" class="btn btn-primary">Begin Pre-Review</button>

<img src="~/Content/img/blank.gif" onload="startIssueOrg()" />
<script>
    function startIssueOrg() {
        $("form").unbind("submit");
        $("form").submit(function (event) {
            $("#submitButton").prop("disabled", true)
            if ($("#ReviewName").val().trim() == "") {
                alert("You must specify a review name.");
                event.preventDefault();
            }
            if ($("#DueDate").val().trim()=="")
            {
                alert("You must specify a due date.");
                event.preventDefault();
            }
            if ($("#PrereviewDate").val().trim() == "") {
                alert("You must specify a customization due date.");
                event.preventDefault();
            }
            return;
        });


        var nowTemp = new Date();
        var now = new Date(nowTemp.getFullYear(), nowTemp.getMonth(), nowTemp.getDate(), 0, 0, 0, 0);

        var checkin = $('#PrereviewDate').datepicker({
            format: 'mm-dd-yyyy',
            onRender: function (date) {
                return date.valueOf() < now.valueOf() ? 'disabled' : '';
            }
        }).on('changeDate', function (ev) {
            if (ev.date.valueOf() > checkout.date.valueOf()) {
                var newDate = new Date(ev.date)
                newDate.setDate(newDate.getDate() + 7);
                checkout.setValue(newDate);
            }
            checkin.hide();
            $('#DueDate')[0].focus();
        }).data('datepicker');

        var checkout = $('#DueDate').datepicker({
            format: 'mm-dd-yyyy',
            onRender: function (date) {
                return date.valueOf() <= checkin.date.valueOf() ? 'disabled' : '';
            }
        }).on('changeDate', function (ev) {
            checkout.hide();
        }).data('datepicker');
    }

</script>
