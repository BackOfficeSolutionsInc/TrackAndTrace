@model RadialReview.Models.ViewModels.OrgMembersViewModel

@{
    ViewBag.Title = "Members";
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewBag.Page = "Members";
}

@section top{
    <div class="jumbotron">
        <h1>Manage</h1>
    </div>
}

@section header{
    @Html.Partial("Partial/manageheader")
}

@section hints{
    @Html.AlertBoxDismissable(@"From this page you can add employees to your organization. 
            Employees are assigned questions that evaluate how they are doing in the organization. 
            These can be questions unique to the individual or shared with their teams, positions, or the company as a whole.
            During the review process, peers, teammates, managers and subordinates answer questions of the employee to gauge how well they are fulfilling their responsibilities.
            To begin, click the Add button. You can come back to this any time.", "alert-info", "Info:")
}

@using (Html.BeginStyles())
{
    <style>
        tr.managing {
        }

        tr.notManaging {
            background-color: #F1F1F1;
        }

        .viewEdit {
            opacity: .1;
        }

        span:hover .viewEdit {
            opacity: 1;
        }
    </style>
}

@using (Html.BeginScripts())
{
    <script>

        function SendEmails() {
            $("#sendButton").prop("disabled", true);
            $.ajax({
                url: "/Nexus/SendAllEmails",
                success: function (data) {
                    StoreJsonAlert(data);
                    location.reload();
                }
            });
        }

        function ResendEmails() {
            $("#resendButton").prop("disabled", true);
            $.ajax({
                url: "/Nexus/ResendAllEmails",
                success: function (data) {
                    StoreJsonAlert(data);
                    location.reload();
                }
            });
        }
    </script>
}


<div class="panel panel-primary">
    <div style="float:right;padding:2px;" class="">
        <button id="resendButton" class="btn btn-default  plus" onclick="ResendEmails()">
            Resend all invites
        </button>
        <button id="sendButton" class="btn btn-default  plus" onclick="SendEmails()">
            Send invites
        </button>
        <button class="btn btn-default  plus" style="width: 69px;" onclick="@Html.ShowModal("Add managed user", "/User/AddModal", "/nexus/AddManagedUserToOrganization")">
            Add
        </button>
    </div>
    <div class="panel-heading">

        <h3 class="panel-title">Manage Members</h3>

    </div>
    <div class="table-responsive">
        <table class="table table-condensed table-hover">
            <thead>
                <tr>
                    <th style="width:15px;" class="alignCenter smallPad"></th>
                    <th>Name</th>
                    <th>Email</th>
                    <th style="min-width:10px" class="NalignCenter">Positions</th>
                    <th style="min-width:10px" class="NalignCenter">Teams</th>
                    <th style="min-width:10px" class="NalignCenter">Managers</th>
                    <th style="width:10px" class="NalignCenter">Questions</th>
                </tr>
            </thead>
            <tbody>
            @foreach (var p in Model.Users.OrderByDescending(x => x.Managing).ThenByDescending(x => x.Verified).ThenBy(x => x.Name))
            {
                <tr class="@(p.Managing?"managing":"grayRow")">
                    <td class="alignCenter noselect">
                        @*@((p.Managing).GetIcon("glyphicon-eye-open strokeLightGreen", "glyphicon-eye-close gray", "You are managing", "You are not managing"))*@


                        @*if (p.Managing)
                            {
                                <div onclick="@Html.ShowModal("Edit " + p.Name, Url.Action("EditModal", "User", new { id=p.Id }), Url.Action("EditModal", "User"))" class="editButton"></div>
                            }*@

                        <span @if (p.Manager) { @: class="glyphicon glyphicon-tower gold strokeGold" title="A manager"
                                                } else {  @: class="glyphicon glyphicon-user blue strokeBlue" title="Not a manager"
                                                }
                              @if (p.Managing) { @: style="cursor:pointer;" onclick="@Html.ShowModal("Edit " + p.Name, Url.Action("EditModal", "User", new { id=p.Id }), Url.Action("EditModal", "User"))"
                                                                                                                                                                                                                  }>
                        </span>


                        @if (p.Verified || !p.Managing)
                        {
                            @p.Verified.GetIcon("glyphicon-ok-sign strokeGray gray", "glyphicon-envelope strokeGray gray", "Joined", "Has not joined")
                        }
                        else
                        {
                            if (p.EmailSent)
                            {
                                <span title="Resend Email" class="glyphicon glyphicon-envelope strokeRed red clickable icon" onclick="@Html.ShowModal("Resend Email", "/Organization/ResendJoin/" + p.Id, "/Organization/ResendJoin/" + p.Id)"></span>
                            }
                            else
                            {
                                <span class="glyphicon glyphicon-exclamation-sign red strokeRed clickable icon" title="Invitation not sent." onclick="@Html.ShowModal("Send Email", "/Organization/ResendJoin/" + p.Id, "/Organization/ResendJoin/" + p.Id)"></span>
                            }
                        }
                    </td>
                    <td class="noOverflow" style="max-width: 160px;" title="@p.Name">
                        <a href="~/Manage/UserDetails/@p.Id">
                            @p.Name
                        </a>
                    </td>
                    <td class="noOverflow" style="max-width: 150px;" title="@p.Email"><a href="mailto:@p.Email">@p.Email</a></td>
                    <td class="NalignCenter noOverflow" style="max-width: 200px;">
                        <a href="@Url.Action("Positions","User",new {id = p.Id})" class="fullWidth">
                            @Html.EditFirstButton(p.PositionTitles, p.Managing)
                        </a>
                    </td>
                    <td class="NalignCenter noOverflow" style="max-width: 80px;">
                        <a href="@Url.Action("Teams","User",new {id = p.Id})" class="fullWidth">
                            @Html.EditFirstButton(p.TeamsTitles, p.Managing)
                        </a>
                    </td>
                    <td class="NalignCenter noOverflow" style="max-width: 180px;">
                        <a href="@Url.Action("Managers", "User", new { id = p.Id })" class="fullWidth">
                            @Html.EditFirstButton(p.ManagersTitles, p.Managing)
                        </a>
                    </td>
                    <td class="NalignCenter noOverflow">
                        <a href="@Url.Action("Edit", "Responsibilities", new { id = p.Id })" class="fullWidth">
                            <span>
                                @Html.ViewOrEdit(p.Managing)
                                <span title="Number of individual questions">@(p.NumIndividualResponsibilities)</span>+<span title="Number of other questions">@(p.NumTotalResponsibilities - p.NumIndividualResponsibilities)</span>
                            </span>

                        </a>
                    </td>
                </tr>
            }
            </tbody>

        </table>

    </div>
</div>
