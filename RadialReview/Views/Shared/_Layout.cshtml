@using Microsoft.AspNet.Identity
@using RadialReview.Properties
@using RadialReview
<!DOCTYPE html>
<html>
<head>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="SHORTCUT ICON" href="/content/favicon.ico" />

    <link href='http://fonts.googleapis.com/css?family=Lato:400,900,100' rel='stylesheet' type='text/css'>
    <title>@ViewBag.Title - @RadialReview.Properties.ProductStrings.ProductName</title>
    <link href="~/Content/jquery.qtip.css" rel="stylesheet" />
    @Styles.Render("~/Content/css")
    @Scripts.Render("~/bundles/modernizr")
    @RenderSection("styles", required: false)
    @Html.PageStyles()


</head>
@if (ViewBag.HasBaseController == null)
{
    throw new Exception("You must extend from the base controller.");
}

<body>
    @if(ViewBag.IsLocal??false)
    { 
        <div id="local"></div>
    }
    <div class="statusContainer">
        <div id="status">No status</div>
    </div>
    <div id="wrap">
        <div id="main">
            <div class="navbar navbar-inverse navbar-fixed-top">
                <div class="container">
                    <div class="navbar-header">
                        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </button>
                        <div id="logo">
                            <div class="link">
                                <a href="@Url.Action("Index", "Home")" class="navbar-brand">
                                    <span style="z-index:1000001;position:relative;">Radial</span>
                                    <div class="circles">
                                        <div class="circle2 navbar-brand"></div>
                                        <div class="circle1 navbar-brand"></div>
                                    </div>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="navbar-collapse collapse">
                        <ul class="nav navbar-nav">
                            @if (Request.IsAuthenticated)
                            {
                                if (((int?)ViewBag.Organizations ?? 0) == 0)
                                {
                                    <li>
                                        <a href="@Url.Action("Code", "Account")" class="@(ViewBag.TaskCount == 0?"":"flashing")">
                                            Access Code
                                            <span id="TasksNotification" style="display:none;" class="glyphicon glyphicon glyphicon-flag"></span>
                                        </a>
                                    </li>                                    
                                }
                                
                                
                                if (((int?)ViewBag.Organizations ?? 0) > 0)
                                {
                                <li>
                                    <a href="@Url.Action("Index", "Tasks")" class="@(ViewBag.TaskCount == 0?"":"flashing")">
                                        Tasks
                                        @if (ViewBag.TaskCount > 0)
                                        {
                                            @:[@ViewBag.TaskCount]
                                        }
                                        <span id="TasksNotification" style="display:none;" class="glyphicon glyphicon glyphicon-flag"></span>
                                    </a>
                                </li>

                                    <li>
                                        <a href="@Url.Action("Outstanding", "Reviews")">
                                            Reviews
                                            <span id="ManageNotification" style="display:none;" class="glyphicon glyphicon-exclamation-sign"></span>
                                        </a>
                                    </li>
                                    <li>
                                        <a href="@Url.Action("Index", "Reports")">
                                            Reports
                                            <span id="ReviewsNotification" style="display:none;" class="glyphicon glyphicon-exclamation-sign"></span>
                                        </a>
                                    </li>
                                }
                                if (ViewBag.IsManager ?? false)
                                {
                                    <li>
                                        <a href="@Url.Action("Index", "Manage")">
                                            Manage
                                            <span id="ManageNotification" style="display:none;" class="glyphicon glyphicon-exclamation-sign"></span>
                                        </a>
                                    </li>
                                }
                            }
                            else
                            {
                                <li>@Html.ActionLink(RadialReview.Properties.DisplayNameStrings.about, "Index", "Home")</li>
                            }
                        </ul>
                        @Html.Partial("_LoginPartial", (string)ViewBag.ReturnUrl)
                    </div>
                </div>
            </div>
            @RenderSection("top", false)
            <div class="container body-content">
                @RenderSection("header", false)
                <div class="clearfix subheading">@ViewBag.Subheading</div>
                <div id="alerts">
                </div>
                <div class="@((bool?)ViewBag.Hints ?? true ? "" : "hidden")">
                    @RenderSection("hints", false)
                </div>
                @RenderBody()
                @*<hr/>*@
            </div>
            <div id="spinnerContainer"></div>
        </div>
        @Html.Partial("Partial/_Modal")
        @using (var s = Html.BeginScripts())
        {
            <script src="~/Scripts/Main/radial.js"></script>
            
            <script>                
                $(function () {
                    qtip();
                    ForceUnhide();
                    @if(ViewBag.Alert!=null)
                    {
                        @:showAlert("@ViewBag.Alert");
                    }
                    @if(ViewBag.Success!=null)
                    {
                        @:showAlert("@ViewBag.Success", "alert-success", "Success!");
                    }

                    var data = localStorage.getItem("Alert");
                    localStorage.setItem("Alert", null);

                    var alert = JSON.parse(data);
                    if (alert !== undefined && alert != null && alert != "null") {
                        var type = alert.type;
                        var title = alert.title;
                        var message = alert.message;

                        if (type === undefined)
                            type = "alert-success";
                        if (title === undefined)
                            title = "Success!";
                        if (message === undefined)
                            message = "";

                        showAlert(message, type, title);
                    }

                });
            </script>
        }

    </div>
    <div id="footer">
        <p>&copy; @DateTime.Now.Year - @RadialReview.Properties.ProductStrings.CompanyName</p>
        @Html.Partial("Partial/Footer")
    </div>
    @Scripts.Render("~/bundles/jquery")
    <script src="~/Scripts/jquery/jquery.qtip.js"></script>
    <script src="~/Scripts/jquery.signalR-2.0.1.min.js"></script>
    <script src="~/signalr/hubs"></script>
    @Scripts.Render("~/bundles/bootstrap")
    @RenderSection("scripts", required: false)
    @RenderSection("modals", required: false)
    @Html.PageScripts()
</body>
</html>
