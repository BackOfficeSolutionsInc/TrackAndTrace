@using Microsoft.AspNet.Identity
@using RadialReview.Properties
@using RadialReview

@{ 
	var limitFiveState = ViewBag.LimitFiveState ?? true;
}

<!DOCTYPE html>
<html class="@(ViewBag.FullHeight ?? false ? "body-full-height" : "body-normal-height")  @(ViewBag.NoTitleBar?? false?"body-notitlebar":"")">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	@*<meta http-equiv="X-UA-Compatible" content="IE=8">*@


	<link rel="apple-touch-icon" sizes="57x57" href="https://s3.amazonaws.com/Radial/icons/TractionTools/res/apple-touch-icon-57x57.png">
	<link rel="apple-touch-icon" sizes="60x60" href="https://s3.amazonaws.com/Radial/icons/TractionTools/res/apple-touch-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="https://s3.amazonaws.com/Radial/icons/TractionTools/res/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="https://s3.amazonaws.com/Radial/icons/TractionTools/res/apple-touch-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="https://s3.amazonaws.com/Radial/icons/TractionTools/res/apple-touch-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="https://s3.amazonaws.com/Radial/icons/TractionTools/res/apple-touch-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="https://s3.amazonaws.com/Radial/icons/TractionTools/res/apple-touch-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="https://s3.amazonaws.com/Radial/icons/TractionTools/res/apple-touch-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="https://s3.amazonaws.com/Radial/icons/TractionTools/res/apple-touch-icon-180x180.png">
	@*<link rel="icon" type="image/png" href="https://s3.amazonaws.com/Radial/icons/TractionTools/res/favicon-16x16.png" sizes="16x16">
		<link rel="icon" type="image/png" href="https://s3.amazonaws.com/Radial/icons/TractionTools/res/favicon-32x32.png" sizes="32x32">*@
	<link rel="icon" type="image/png" href="https://s3.amazonaws.com/Radial/icons/TractionTools/res/favicon-96x96.png" sizes="96x96">
	<link rel="icon" type="image/png" href="https://s3.amazonaws.com/Radial/icons/TractionTools/res/android-chrome-192x192.png" sizes="192x192">
	<meta name="msapplication-square70x70logo" content="https://s3.amazonaws.com/Radial/icons/TractionTools/res/smalltile.png" />
	<meta name="msapplication-square150x150logo" content="https://s3.amazonaws.com/Radial/icons/TractionTools/res/mediumtile.png" />
	@*<meta name="msapplication-wide310x150logo" content="/widetile.png" />*@
	<meta name="msapplication-square310x310logo" content="https://s3.amazonaws.com/Radial/icons/TractionTools/res/largetile.png" />

	@if (ViewBag.IsLocal ?? false) {
		<link rel="SHORTCUT ICON" href="/content/favicon-local.ico?v=4" />
	} else {
		<link rel="SHORTCUT ICON" href="/content/favicon.ico?v=3" />
	}

	<style>
		[ng\:cloak], [ng-cloak], .ng-cloak {
			display: none !important;
		}
	</style>


	<link href='https://fonts.googleapis.com/css?family=Lato:400,900,100' rel='stylesheet' type='text/css'>
	@if (ViewBag.Title == null) {
		<title>@Html.ProductName()</title>
	} else {
		<title>@ViewBag.Title - @Html.ProductName()</title>
	}
	@*<link href="" rel="stylesheet" />*@
	@Styles.Render("~/Content/css")
	@RenderSection("styles", required: false)
	@Html.PageStyles()
	@if (ViewBag.VideoChatRoom != null) {
		<link href="~/Content/L10/L10Conference.css" rel="stylesheet" />
	}
	<link href="/User/styles" rel="stylesheet" type="text/css" />
	<script>

		window.dateFormat = '@(Html.Organization().NotNull(x=>x.Settings.NotNull(y=>y.GetDateFormat()))??"MM-dd-yyyy")';
	</script>
</head>
@if (ViewBag.HasBaseController == null) {
	throw new Exception("You must extend from the base controller.");
}
<body id="body" class="@(ViewBag.FullWidth ?? false ? "body-full-width" : "body-normal-width")  @(ViewBag.LayoutClass??"")  @(limitFiveState?"fivestate-limit-true":"")">
	<script>
		window.UserId = @(ViewBag.UserId??-1);
		window.OrgId = @(ViewBag.OrganizationId ?? -1);
		window.Title = "@(ViewBag.Title ?? "")";
		window.ServerTime = new Date(@DateTime.UtcNow.ToJavascriptMilliseconds());
		window.ServerTimeDiff = window.ServerTime - new Date();
		window.ConvertFromServerTime=function(serverTime){return serverTime -window.ServerTimeDiff;}
		window.ConvertToServerTime = function (clientTime){return clientTime + window.ServerTimeDiff;}
		window.LimitFiveState = @((""+limitFiveState).ToLower());
	</script>


	@RenderSection("topSection", required: false)

	@if (ViewBag.IsLocal ?? false) {
		<div id="local"></div>
		<div class="debugger"></div>
	}
	<div class="statusContainer"><div id="status">No status</div></div>
	<div id="wrap">
		<div id="main">
			@if (!(ViewBag.NoTitleBar ?? false)) {
				<div class="navbar navbar-inverse navbar-fixed-top">
					<div class="container body-navbar">
						<div class="navbar-header">
							<button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
								<span class="icon-bar"></span>
							</button>
							@if (ViewBag.FullLogo as bool? != true) {
								<div id="logo">
									<div class="link">
										<a href="@Url.Action("Index", "Home")" class="navbar-brand">
											<span style="z-index: 1000001; position: relative; top: -2px;">
												<img src="/Content/img/TRACTION-TOOLS_large_icon_wh.png" height="54" width="54" style="opacity: .95;">
											</span>
										</a>
									</div>
								</div>
							} else {
								<div id="logo">
									<div class="link">
										<a href="@Url.Action("Index", "Home")" class="navbar-brand">
											<span style="z-index: 1000001; position: relative; top: -2px;">
												<img src="/Content/img/TRACTION-TOOLS_small_horizontal_wh.png" height="54" style="opacity: .95;">
											</span>
										</a>
									</div>
								</div>
							}
							<span class="pull-right navbar-icon-container visible-xs">
								@if (((int?)ViewBag.Organizations ?? 0) > 0) {
									if (ViewBag.ShowL10) {
										<span id="header-tab-new-headline" class="navbar-icon-button icon fontastic-icon-bookmark headlineModal" title="New People Headline"></span>
										<span id="header-tab-new-issue" class="navbar-icon-button glyphicon1 glyphicon-pushpi1n icon fontastic-icon-pinboard issuesModal" data-method="CreateIssueRecurrence" title="New Issue"></span>
									}
									<span id="header-tab-new-todo" class="navbar-icon-button glyphicon glyphicon-check todoModal" data-method="CreateTodoRecurrence" title="New To-do"></span>
								}
							</span>

						</div>
						<div class="navbar-collapse collapse">
							<ul class="nav navbar-nav">
								@if (Request.IsAuthenticated) {
									if (((int?)ViewBag.Organizations ?? 0) == 0) {
										<li>
											<a href="@Url.Action("Index", "Home")" class="@(ViewBag.TaskCount == 0?"":"flashing")">
												Access Code
												<span id="TasksNotification" style="display:none;" class="glyphicon glyphicon glyphicon-flag"></span>
											</a>
										</li>
									}


									if (((int?)ViewBag.Organizations ?? 0) > 0) {
										<li>
											<a href="@Url.Action("Index", "Home")" id="header-tab-workspace">
												Workspace
												<span id="DashboardNotification" style="display: none;" class="glyphicon glyphicon-exclamation-sign"></span>
											</a>
										</li>

										if (ViewBag.ShowL10 ?? false) {
											<li>
												<a href="@Url.Action("Index", "L10")" id="header-tab-l10">
													L10
													<span id="L10Notification" style="display: none;" class="glyphicon glyphicon-exclamation-sign"></span>
												</a>
											</li>
										}
										if (ViewBag.ShowReview ?? false) {
											<li>
												<a href="@Url.Action("Index", "Reviews")" id="header-tab-reviews">
													@(Html.ReviewName())s
													<span id="ReviewsNotification" style="display: none;" class="glyphicon glyphicon-exclamation-sign"></span>
												</a>
											</li>
										}
										if (ViewBag.ShowAC ?? false) {
											<li>
												<a href="@Url.Action("Chart", "Accountability")" id="header-tab-ac">
													AC
													<span id="AcNotification" style="display: none;" class="glyphicon glyphicon-exclamation-sign"></span>
												</a>
											</li>
										}
										if (ViewBag.ShowSurvey ?? false) {
											<li>
												<a href="@Url.Action("Index", "Survey")" id="header-tab-survey">
													Surveys
													<span id="SurveyNotification" style="display: none;" class="glyphicon glyphicon-exclamation-sign"></span>
												</a>
											</li>
										}
									}
								} else {
								}
							</ul>
							@if (!(ViewBag.IsLogin ?? false)) {
								Html.RenderPartial("_LoginPartial", (string)ViewBag.ReturnUrl);
							}
						</div>
					</div>
				</div>
				<script>
					//Test for IOS
					if ((/iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream)) {
						document.getElementById("body").className += " is-ios";
						var allowBack = document.referrer != "" && document.referrer.toLowerCase().lastIndexOf("/account/login") == -1;

						var link = allowBack ?"javascript:history.back()":"#";
						var disabled = allowBack ?"":"disabled";
						var newLogo = "<span class='link'><a class='"+disabled+"' href='"+link+"'>Back</a></span>";
						document.getElementById("logo").innerHTML =newLogo						
					}
				</script>

			}
			@RenderSection("top", false)
			<div class="container body-content">
				@RenderSection("header", false)
				<div class="clearfix subheading noPrint hidden-xs">@ViewBag.Subheading</div>
				<div id="alerts"></div>
				<div class="@((bool?)ViewBag.Hints ?? true ? "" : "hidden")">
					@RenderSection("hints", false)
				</div>
				@RenderBody()
				<div class="footer-bar">@{ Html.RenderPartial("Partial/_VideoChat"); }</div>
			</div>
			<div id="animationContainer"></div>
		</div>
		@{Html.RenderPartial("Partial/_Modal");}
		@using (var s = Html.BeginScripts()) {
				<!--script src="~/Scripts/Main/radial.js"></script-->
			<script>
				$(function () {
					//qtip();
					$('[data-toggle="tooltip"]').tooltip();
					ForceUnhide();
					@if (ViewBag.Alert!=null){
							@:showAlert("@ViewBag.Alert");
															                                        }
					@if(ViewBag.Success!=null){
                      @: showAlert("@ViewBag.Success", "alert-success" , "Success!" );

                    }
					@if(ViewBag.InfoAlert!=null){
                        @: showAlert("@ViewBag.InfoAlert", "alert-info" , "Info!" );
															                                        }
					UnstoreJsonAlert();
				});  var statusTimeout;
			</script>
		}
	</div>
	@if (!(ViewBag.NoTitleBar ?? false)) {
		<div id="footer">
			<p>&copy; @DateTime.Now.Year - @RadialReview.Properties.ProductStrings.CompanyName &amp; EOS</p>
			@{ Html.RenderPartial("Partial/Footer"); }
		</div>
				}
	@RenderSection("bottomSection", required: false)
	<div class="scripts-container">
		<script src="https://cdn.polyfill.io/v2/polyfill.js?features=CustomEvent"></script>
		@Scripts.Render("~/bundles/jquery")
		@if (RadialReview.Utilities.Config.GetEnv() == RadialReview.Models.Enums.Env.local_test_sqlite) {
			<script type="text/javascript">
				$(function(){
					window.onerror=function(message, source, lineno, colno, error){
						try{
							$(".JSError").append($("<li><div class='error'>"+msg+"</div>"+
								"<div class='source'>"+source+"</div>"+
								"<div class='lineno'>"+lineno+"</div>"+
								"<div class='colno'>"+colno+"</div>"+
								"<div class='error'>"+error+"</div></li>"));
						}catch(e){
							debugger;
						}
					}
				});
				(function(){
					var oldError = console.error;
					console.error = function (a1,a2,a3,a4,a5,a6) {
						try{
							// DO MESSAGE HERE.
							$(".JSError").append($("<li class='console_error'>"+
						  "<div class='a1'>"+a1+"</div>"+
						  "<div class='a2'>"+a2+"</div>"+
						  "<div class='a3'>"+a3+"</div>"+
						  "<div class='a4'>"+a4+"</div>"+
						  "<div class='a5'>"+a5+"</div>"+
						  "<div class='a6'>"+a6+"</div></li>"));

						}catch(e){
							debugger;
						}
						oldError.apply(console, [a1,a2,a3,a4,a5,a6]);
					};
				})();

			</script>
			<ul class="JSError" style="position:fixed;top:0px;right:0px;opacity:.5;pointer-events:none;"></ul>
		}


		<script src="https://ajax.aspnetcdn.com/ajax/signalr/jquery.signalr-2.2.0.min.js"></script>
		@Scripts.Render("~/bundles/bootstrap")
		@RenderSection("scripts", required: false) @RenderSection("modals", required: false)
		<!--Begin Main Scripts-->
		@Scripts.Render("~/bundles/main")
		<script src="~/signalr/hubs"></script>
		<!--End Main Scripts-->
		@Html.PageScripts()
		<script>
			(function (i, s, o, g, r, a, m) { i['GoogleAnalyticsObject'] = r; i[r] = i[r] || function () { (i[r].q = i[r].q || []).push(arguments) }, i[r].l = 1 * new Date(); a = s.createElement(o), m = s.getElementsByTagName(o)[0]; a.async = 1; a.src = g; m.parentNode.insertBefore(a, m) })(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga'); ga('create', 'UA-68333423-1',{'userId':@(ViewBag.UserId??-1L)}); ga('set', 'dimension1', @(ViewBag.UserId??-1L)); ga('send', 'pageview');
		</script>
	</div>

</body>

</html>

@{
	RadialReview.Utilities.Productivity.ChromeExtensionComms.SendCommand("pageLoad");
}