@model RadialReview.Controllers.TeamController.TeamViewModel

@{
    ViewBag.Title = "Edit";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section header{
    @Html.Partial("Partial/manageheader")
}


<div class="panel panel-primary">
    <div class="panel-heading">
        <h3 class="panel-title">
            Edit team: <i>@Model.Team.GetName()</i>
            @if (Model.Team.Type != RadialReview.Models.Enums.TeamType.Standard)
            {
                <small>(Auto-generated)</small>
            }
        </h3>
    </div>
    <table class="table">
        <tr>
            <th>Team</th>
            <th style="width: 150px;" class="alignCenter">Start</th>
            <th style="width: 150px;" class="alignCenter">End</th>
            @if (Model.Team.Type == RadialReview.Models.Enums.TeamType.Standard)
            {
                <th style="width:100px;">

                    <a class="btn btn-default fullWidth" onclick="@Html.ShowModal(
                        "Add user to "+Model.Team.GetName(),
                        Url.Action("AddModal", "Team", new { id = Model.Team.Id }),
                        Url.Action("AddModal", "Team")
                    )">+</a>

                </th>
            }
        </tr>
        @foreach (var p in Model.Members.OrderBy(x => x.DeleteTime).ThenBy(x => x.Start))
        {
            <tr id="row_@p.Id" class="@(p.DeleteTime != null ? "danger" : "")">
                <td class="position">@p.User.GetName()</td>
                <td class="alignCenter">@p.Start.ToShortDateString()</td>
                <td class="alignCenter endTime">@(p.DeleteTime.HasValue ? p.DeleteTime.Value.ToShortDateString() : "Present")</td>
                @if (Model.Team.Type == RadialReview.Models.Enums.TeamType.Standard)
                {
                    <td class="deleteButton">

                        @if (p.DeleteTime == null)
                        {
                            <a onclick="Delete(@p.Id)" class="btn btn-danger fullWidth">Delete</a>
                        }
                        else
                        {
                            <div class="fullWidth alignCenter" style="color: #929292">Deleted</div>
                        }

                    </td>
                }
            </tr>
        }
    </table>
</div>


@using (var s = Html.BeginScripts())
{
    <script>
        function Delete(id)//id=teamDurationId
        {
            $.ajax({
                url: "/User/RemoveTeam/" + id,
                success: function (data) {
                    $("#row_" + id).addClass("danger");
                    $("#row_" + id + " .deleteButton").html("<div class='fullWidth alignCenter' style='color: #929292'>Deleted</div>");
                    $("#row_" + id + " .endTime").html("Just now");
                }
            })
        }
    </script>
}

@using (var s = Html.BeginStyles())
{
    <style>
        tr.danger .position {
            text-decoration: line-through;
        }
    </style>
}