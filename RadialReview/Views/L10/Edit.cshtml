@using RadialReview.Models
@model RadialReview.Models.L10.VM.L10EditVM
@{
	ViewBag.Title = "Edit L10 Meeting";
	Layout = "~/Views/Shared/_Layout.cshtml";
}

@section top{

	<div class="jumbotron">
		<h1 class="nameFade">L10 Meeting</h1>
	</div>
}
<div class="pull-left smallBreak2">
	@{

		if (Model.Recurrence.Id != 0)
		{
			Html.RenderAction("Dropdown", "Permissions", new { id = Model.Recurrence.Id, type = PermItem.ResourceType.L10Recurrence });
		}
	}
</div>
<div class="clearfix"></div>

<div class="panel panel-primary ">
	<div class="panel-heading">
		<h3 class="panel-title">Edit L10 Meeting</h3>
	</div>
	<div class="panel-body form-horizontal">
		<form class="" action="/L10/Edit" method="POST">
			<div class="form-group">
				<label class="col-sm-3 control-label">Meeting Name:</label>
				<div class="col-sm-9">
					@Html.TextBoxFor(x => x.Recurrence.Name, new { @class = "form-control editable", style = "width:100%;", placeholder = "Add a name for the meeting..." })
				</div>
			</div>

			<div class="form-group">
				<label class="col-sm-3 control-label">Members:</label>
				<div class="col-sm-9">
					@Html.ListBoxFor(x =>
					   x.SelectedMembers,
						Model.PossibleMembers.ToSelectList(x => x.GetNameAndTitle(), x => x.Id).OrderBy(x => x.Text),
								 new { @class = "select2 form-control attendee editable", style = "max-width:600px;width:100%;", multiple = "", placeholder = "Click here or begin typing a name..." })
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">Measurables:</label>
				<div class="col-sm-9">
					@Html.ListBoxFor(x =>
						x.SelectedMeasurables,
						Model.PossibleMeasurables.ToSelectList(x => x.Title + " (Owner: " + x.AccountableUser.GetName() + ")", x => x.Id).OrderBy(x => x.Text),
										  new { @class = "select2 form-control measurables editable", style = "max-width:600px;width:100%;", multiple = "", placeholder = "Click here or begin typing a measurable..." })
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">@Html.Organization().Settings.RockName:</label>
				<div class="col-sm-9">
					@Html.ListBoxFor(x =>
						x.SelectedRocks,
						Model.PossibleRocks.ToSelectList(x => x.ToFriendlyString(), x => x.Id).OrderBy(x => x.Text),
								 new { @class = "select2 form-control rocks editable", style = "max-width:600px;width:100%;", multiple = "", placeholder = "Click here or begin typeing one of your " + Html.Organization().Settings.RockName + "..." })
				</div>
			</div>
			<hr />
			<div class="form-group">
				<label class="col-sm-3 control-label">Segue duration (minutes):</label>
				<div class="col-sm-9">
					@Html.TextBox(Html.NameFor(x => x.Recurrence.SegueMinutes).ToHtmlString(), String.Format("{0:0.##}", Model.Recurrence.SegueMinutes), new { @class = "select2 form-control editable", type = "number", min = "0", step = "any", max = "500" })
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">Scorecard duration (minutes):</label>
				<div class="col-sm-9">
					@Html.TextBox(Html.NameFor(x => x.Recurrence.ScorecardMinutes).ToHtmlString(), String.Format("{0:0.##}", Model.Recurrence.ScorecardMinutes), new { @class = "select2 form-control editable", type = "number", min = "0", step = "any", max = "500" })
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">@Html.Organization().Settings.RockName Review duration (minutes):</label>
				<div class="col-sm-9">
					@Html.TextBox(Html.NameFor(x => x.Recurrence.RockReviewMinutes).ToHtmlString(), String.Format("{0:0.##}", Model.Recurrence.RockReviewMinutes), new { @class = "select2 form-control editable", type = "number", min = "0", step = "any", max = "500" })
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">Headlines duration (minutes):</label>
				<div class="col-sm-9">
					@Html.TextBox(Html.NameFor(x => x.Recurrence.HeadlinesMinutes).ToHtmlString(), String.Format("{0:0.##}", Model.Recurrence.HeadlinesMinutes), new { @class = "select2 form-control editable", type = "number", min = "0", step = "any", max = "500" })
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">Todo List duration (minutes):</label><div class="col-sm-9">
					@Html.TextBox(Html.NameFor(x => x.Recurrence.TodoListMinutes).ToHtmlString(), String.Format("{0:0.##}", Model.Recurrence.TodoListMinutes), new { @class = "select2 form-control editable", type = "number", min = "0", step = "any", max = "500" })
				</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">IDS duration (minutes):</label>
				<div class="col-sm-9">@Html.TextBox(Html.NameFor(x => x.Recurrence.IDSMinutes).ToHtmlString(), String.Format("{0:0.##}", Model.Recurrence.IDSMinutes), new { @class = "select2 form-control editable", type = "number", min = "0", step = "any", max = "500" })</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">Conclusion duration (minutes):</label>
				<div class="col-sm-9">@Html.TextBox(Html.NameFor(x => x.Recurrence.ConclusionMinutes).ToHtmlString(), String.Format("{0:0.##}", Model.Recurrence.ConclusionMinutes), new { @class = "select2 form-control editable", type = "number", min = "0", step = "any", max = "500" })</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">Default To-do Owner:</label>
				<div class="col-sm-9"><select name='@Html.NameFor(x => x.Recurrence.DefaultTodoOwner).ToHtmlString()' class="select2 form-control default-todo-list editable"></select></div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">Show Individual To-do Completion:</label>
				<div class="col-sm-9">@Html.CheckBoxFor(x => x.Recurrence.IncludeIndividualTodos, new { @class = "editable", style = "margin-top: 11px;" })</div>
			</div>
			<div class="form-group">
				<label class="col-sm-3 control-label">Show Aggregate To-do Completion:</label>
				<div class="col-sm-9">@Html.CheckBoxFor(x => x.Recurrence.IncludeAggregateTodoCompletion, new { @class = "editable", style = "margin-top: 11px;" })</div>
			</div>
			
			<div class="form-group">
				<label class="col-sm-3 control-label">Transcribe Meeting :</label>
				<div class="col-sm-9">@Html.CheckBoxFor(x => x.Recurrence.EnableTranscription, new { @class = "editable", style = "margin-top: 11px;" }) <span class="gray">(Chrome Only!)</span></div>
			</div>

			@Html.SecuredHiddenFor(x => x.Recurrence.Id)
			@Html.SecuredHiddenFor(x => x.Recurrence.CreateTime)
			@Html.SecuredHiddenFor(x => x.Recurrence.OrganizationId)
			@Html.SecuredHiddenFor(x => x.Recurrence.MeetingInProgress)
			@Html.SecuredHiddenFor(x => x.Recurrence.CreatedById)
			@Html.SecuredHiddenFor(x => x.Recurrence.VideoId)
			@Html.SecuredHiddenFor(x => x.Recurrence.OrderIssueBy)

			@Html.HiddenFor(x => x.Return)
			<div class="alignCenter">
				<input class="btn btn-primary" type="submit" value="Submit" />
			</div>
			<br />
			<div class="alignCenter">
				<div class="btn btn-danger" onclick="@Html.ShowModal("Are you sure you want to delete this meeting?", "/L10/Delete/", "/L10/Delete/" + Model.Recurrence.Id, onCompleteFunction: "goL10")">Delete meeting</div>
			</div>
		</form>
	</div>
</div>


@using (Html.BeginScripts())
{
	<script>

		var selectedTodoList = @Model.Recurrence.DefaultTodoOwner;
		var changes = false;

		$("form").on("submit", function() {
			changes = false;
		});

		$(function() {

			$(".editable").on("keyup", function() {
				changes = true;
			});

			$(".editable").on("change", function() {
				changes = true;
			});
		});

		function updateTodoList() {
			$(".default-todo-list").html("");
			$(".attendee").find('option:selected').each(function(){
				var selected = $(this).val() == selectedTodoList ? "selected" : "";
				$(".default-todo-list").append("<option value='" + $(this).val() + "' " + selected + ">"+$(this).text()+"</option>");
			});;
		}


		$(".default-todo-list").on("change", function() {
			selectedTodoList = $(this).val();
		});

		$(".attendee").on("change", function() {
			updateTodoList();
		});


		function goL10() {
			window.location = "/L10";
		}

		//$(".select2").hide();

		$(".select2.attendee").select2({
			/*matcher: function (term, text) {
				var split = text.text.split("(")[0].split(" ");
				if (!term || !term.term)
					return false;
				var t = term.term.toUpperCase();
				for (var i = 0; i < split.length; i++) {
					var s = split[i].toUpperCase();
					if ($.trim(s) == '')
						continue;
					if (s.indexOf(t) == 0)
						return true;
				}
				return false;
			},*/
		});
		$(".select2.measurables,.select2.rocks").select2({
			/*matcher: function (term, text) {
				var split = text.text.split("(")[0].split(" ");
				var t = term.toUpperCase();
				for (var i = 0; i < split.length; i++) {
					var s = split[i].toUpperCase();
					if ($.trim(s) == '')
						continue;
					if (s.indexOf(t) == 0)
						return true;
				}
				return false;
			}*/
		});

		window.onbeforeunload = function(f) {
			if (changes) {
				return "Leave without saving?";
			}

		};

		$(function() {
			updateTodoList();
		});

		//$(".measurables, .attendee").fadeIn();
	</script>
}