@{
    var headers = (ViewBag.AddHeaders == null || ((bool)ViewBag.AddHeaders) == true);
    var controller = (ViewBag.AddController != null && ((bool)ViewBag.AddController) == true);
    //var datepicker = (ViewBag.AddDatePicker == null || ((bool)ViewBag.AddDatePicker) == true);
    //var includeOwner = (ViewBag.IncludeOwner == null || ((bool)ViewBag.IncludeOwner) == true);
    //var rockName = (ViewBag.RockName ?? Html.Organization().NotNull(x => x.Settings.NotNull(y => y.RockName)));
    //var includeTitle = (ViewBag.IncludeTitle == null || ((bool)ViewBag.IncludeTitle) == true);
    var selector = ViewBag.Selector as string ?? "model.Issues | transform:this";
}

<div @(headers ? "ng-app=L10App" : "") class="meeting-review ng-cloak issues-list-container app">
    <div @(headers || controller ? "ng-controller=L10Controller" : "")>

        <table ts-wrapper width="100%" class="component" ng-show="(@(selector) | filter:filters.byRange('CompleteTime',model.date.startDate,model.date.endDate)).length >
            0" click-anywhere-but-here="model.Selected = -1">
            <thead>
                <tr>
                    <th class="checkbox-column"></th>
                    <th class="priority-column" ts-criteria="Priority" ts-default="descending">Priority</th>
                    <th class="owner-column"></th>
                    <th class="issue-column" style="padding-left: 4px;">Issue</th>
                    @*<th></th>
                    <th></th>*@
                    <th class="complete-column">Completed</th>
                </tr>
            </thead>
            <tbody>
                <tr ng-repeat="issue in (@(selector) | transform:this)  | filter:filters.byRange('CompleteTime',model.date.startDate,model.date.endDate)"
                    ng-class="{grayRow: issue.Complete}"
                    @*ng-if="model.Selected!=issue.Key"*@
                    class="clickable"
                    ts-repeat>
                    <td class="checkbox-column" style="vertical-align: top;min-width: 25px;text-align: center;top:5px;position: relative">
                        <input type="checkbox" ng-model="issue.Complete" ng-change="functions.updateComplete(this);functions.sendUpdate(issue)" />
                    </td>
                    <td class="priority-column" style="vertical-align: top;padding-top: 5px;">
                        <priority ng-model="issue.Priority" ng-change="functions.sendUpdate(issue)"></priority>
                    </td>
                    <td style="vertical-align: top" class="owner-column">
                        <a href="#" data-display="false" data-value="{{issue.Owner.Id}}" data-placement="right" class="inlineEdit" data-type="select" data-pk="{{::issue.Id}}" data-url="/L10/XUpdateIssue" data-name="owner" data-source="/Dropdown/MeetingMembers/{{::model.Id}}?userId=true">
                            <profile-image user="issue.Owner"></profile-image>
                        </a>
                    </td>


                    <td class="issue-column" style="width:100%;padding-left:2px" ng-click="issue.DetailsUrl_Src=issue.DetailsUrl;model.Selected = issue.Key">
                        <div style="padding-top: 6px;" ng-if="model.Selected!=issue.Key">{{issue.Name}}</div>
                        <div ng-if="model.Selected==issue.Key">
                            <input ng-model-options="{debounce: 400}" type="text" ng-model="issue.Name" class="fullWidth" ng-change="functions.sendUpdate(issue)" />
                            <iframe style="background-color: white" width="100%" ng-src="{{::trustAsResourceUrl(issue.DetailsUrl_Src)}}" ng-data-src="{{::issue.DetailsUrl}}"></iframe>
                        </div>
                        <table class="sub-issue-column">
                            <tr ng-repeat="sub in issue.Children" class="gray">
                                <td style="width:20px;"></td>
                                <td>{{::sub.Name}}</td>
                            </tr>
                        </table>
                    </td>
                    @*<td class="alignCenter" style="min-width: 75px;">{{issue.DueDate | date:'MM/dd/yy'}}</td>
                    <td style="min-width: 15px;"></td>*@
                    <td class="alignCenter complete-column" style="min-width: 75px;">{{issue.CompleteTime | date:'MM/dd/yy'}}</td>
                </tr>
                @*<tr ng-if="model.Selected==issue.Key" ng-class="{grayRow: issue.Complete}">
                    <td class="checkbox-column" style="vertical-align: top;min-width: 25px;text-align: center;top:5px;position: relative">
                        <input ng-model-options="{debounce: 400}" type="checkbox" ng-model="issue.Complete" ng-change="functions.updateComplete(this);functions.sendUpdate(issue)" />
                    </td>
                    <td class="priority-column">
                        <priority ng-model="issue.Priority" ng-change="functions.sendUpdate(issue)"></priority>
                    </td>
                    <td class="owner-column" style="width:1px;">
                        <a data-value="{{issue.Owner.Id}}" href="#" data-display="false" class="inlineEdit" data-type="select" data-pk="{{issue.Id}}" data-url="/L10/XUpdateIssue" data-name="owner" data-source="/Dropdown/MeetingMembers/{{::model.Id}}?userId=true">
                            <profile-image user="issue.Owner"></profile-image>
                        </a>
                    </td>
                    <td class="issue-column" style="width:100%">
                        <input ng-model-options="{debounce: 400}" type="text" ng-model="issue.Name" class="fullWidth" ng-change="functions.sendUpdate(issue)" />
                    </td>
                    @*<td class="alignCenter" style="min-width: 75px;">{{issue.DueDate | date:'MM/dd/yy'}}</td>
                        <td style="min-width: 15px;"></td>*
                    <td class="alignCenter complete-column" style="min-width: 75px;">{{issue.CompleteTime | date:'MM/dd/yy'}}</td>
                </tr>
                <tr ng-repeat-end ng-if="model.Selected==issue.Key" ng-class="{grayRow: issue.Complete}" style="color:gray">
                    <td class="checkbox-column"></td>
                    <td class="priority-column"></td>
                    <td class="owner-column"></td>
                    <td class="details-column" style="width:100%">
                        @*<textarea ng-model-options="{debounce: 400}" ng-model="issue.Details" class="verticalOnly fullWidth" placeholder="Enter issue details..." style="min-height: 106px;" ng-change="functions.sendUpdate(issue)"></textarea>*
                        <iframe style="background-color: white" width="100%" ng-src="{{::trustAsResourceUrl(issue.DetailsUrl_Src)}}" ng-data-src="{{::issue.DetailsUrl}}"></iframe>

                        <table class="sub-issue-column">
                            <tr ng-repeat="sub in issue.Children" class="">
                                <td style="width:20px;"></td>
                                <td>{{sub.Name}}</td>
                            </tr>
                        </table>
                    </td>
                    <td></td>
                    @*<td></td>
                        <td></td>*
                </tr>*@
            </tbody>
        </table>
        <div class="component gray" style="padding: 30px 15px;clear: both;" ng-show="(@(selector) | filter:filters.byRange('CompleteTime',model.date.startDate,model.date.endDate)).length==0">
            No issues fit your search criteria.
        </div>
    </div>
</div>